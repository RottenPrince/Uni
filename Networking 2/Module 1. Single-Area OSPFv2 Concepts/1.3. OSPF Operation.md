## 1.3.2 OSPF Operational States
Now that you know about the OSPF link-state packets, this topic explains how they work with OSPF-enabled routers. When and OSPF router is initially connected to a network, it attempts to:
- Create adjacencies with neighbors
- Exchange routing information
- Calculate the best routes
- Reach convergence
The table details the states OSPF progress through while attempting to reach convergence:

| State              | Description                                                                                                                                                          |
| ------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Down State**     | - No Hello packets received = Down.<br>- Routers sends Hello packets.<br>- Transition to Init state.                                                                 |
| **Init State**     | - Hello packets are received from the neighbor.<br>- They contain the Router ID of the sending router.<br>- Transition to Two-Way state.                             |
| **Two-Way State**  | - In this state, comminication between the two routers bidirectorial.<br>- On multiaccess links, the routers elect a DR and a BDR.<br>- Transition to ExStart state. |
| **ExStart State**  | On point-to-point networks, the two routers decide which router will initiate the DBD packet exchange and decide upon the initial DBD packet sequence number.        |
| **Exchange State** | - Routers exchange DBD packets.<br>- If additional router information is required then transition to Loading; otherwise, transition to the Full state.               |
| **Loading State**  | - LSRs and LSUs are used to gain additional route information.<br>- Routes are processed using the SPF algorithm.<br>- Transition to the Full state.                 |
| **Full State**     | The link-state database of the router is fully synchronized.                                                                                                         |
## 1.3.3 Establish Neighbor Adjecencies
When OSPF is enabled on an interface, the router must determine if there is another OSPF neighbor on the link. To accomplish this, the router sends a Hello packet that contains its router ID out all OSPF-enabled interfaces. The Hello packet is sent to the reserved All OSPF Routers IPv4 multicast address 224.0.0.5. Only OSPFv2 routers will process these packets. The OSPF router ID is used by the OSPF process to uniquely identify each router in the OSPF area. A router ID is a 32-bit number formatted like an IPv4 address and assigned to uniquely identify a router among OSPF peers.

When a neighboring OSPF-enabled router receives a Hello packet with a router ID that is not within its neighbor list, the receiving router attempts to establish an adjacency with the initiating router.
### 1. Down State to Init State
When OSPFv2 is enabled, the enabled Gigabit Ethernet 0/0 interface transitions from the Down state to the Init state. R1 starts sending Hello packets out all OSPF-enabled interfaces to discover OSPF neighbors to develop adjacencies with.
![[Pasted image 20240929012733.png]]
### 2. The Init State
R2 receives the Hello packet from R1 and adds the R1 router ID to its neighbor list. R2 then sends a Hello packet to R1. The packet contains the R2 Router ID and the R1 Router ID in its list of neighbors on the same interface.![[Pasted image 20240929012801.png]]

### 3. Two-Way State
R1 receives the Hello and adds the R2 Router ID to its list of OSPF neighbors. It also notices its own Router ID in the list of neighbors of the Hello packet. When a router receives a Hello packet with its Router ID listed in the list of neighbors, the router transitions from the Init state to the Two-Way state.

The action performed in Two-Way state depends on the type of interconnection between the adjacent routers, as follows:

- If the two adjacent neighbors are interconnected over a point-to-point link, then they immediately transition from the Two-Way state to the ExStart state.
- If the routers are interconnected over a common Ethernet network, then a designated router DR and a BDR must be elected.![[Pasted image 20240929012841.png]]

### 4. Elect the DR and BDR
Because R1 and R2 are interconnected over an Ethernet network, a DR and BDR election takes place. As shown in the figure, R2 becomes the DR and R1 is the BDR. This process only occurs on multiaccess networks such as Ethernet LANs.

Hello packets are continually exchanged to maintain router information.![[Pasted image 20240929012926.png]]
## 1.3.4 Synchronizing OSPF Databases
After the Two-Way state, routers transition to database synchronization states. While the Hello packet was used to establish neighbor adjacencies, the other four types of OSPF packets are used during the process of exchanging and synchronizing LSDBs. This is a three step process, as follows:

1. Decide first router
2. Exchange DBDs
3. Send an LSR
### 1. Decide First Router
In the ExStart state, the two routers decide which router will send the DBD packets first. The router with the higher router ID will be the first router to send DBD packets during the Exchange state. In the figure, R2 has the higher router ID and sends its DBD packets first.![[Pasted image 20240929013039.png]]

### 2. Exchange DBDs

In the Exchange state, the two routers exchange one or more DBD packets. A DBD packet includes information about the LSA entry header that appears in the LSDB of the router. The entries can be about a link or about a network. Each LSA entry header includes information about the link-state type, the address of the advertising router, the cost of the link, and the sequence number. The router uses the sequence number to determine the newness of the received link-state information.

In the figure, R2 sends a DBD packet to R1. When R1 receives the DBD, it performs the following actions:

1. It acknowledges the receipt of the DBD using the LSAck packet.
2. R1 then sends DBD packets to R2.
3. R2 acknowledges R1.
![[Pasted image 20240929013108.png]]

### 3. Send an LSR

R1 compares the information received with the information it has in its own LSDB. If the DBD packet has a more current link-state entry, the router transitions to the Loading state.

For example, in the figure, R1 sends an LSR regarding network 172.16.6.0 to R2. R2 responds with the complete information about 172.16.6.0 in an LSU packet. Again, when R1 receives an LSU, it sends an LSAck. R1 then adds the new link-state entries into its LSDB.

After all LSRs have been satisfied for a given router, the adjacent routers are considered synchronized and in a full state. Updates (LSUs) are sent only to neighbors in the following conditions:

- When a change is perceived (incremental updates)
- Every 30 minutes
![[Pasted image 20240929013142.png]]

## 1.3.5 The Need for a DR

Why is a DR and BDR election necessary?

Multiaccess networks can create two challenges for OSPF regarding the flooding of LSAs, as follows:

- **Creation of multiple adjacencies** - Ethernet networks could potentially interconnect many OSPF routers over a common link. Creating adjacencies with every router is unnecessary and undesirable. It would lead to an excessive number of LSAs exchanged between routers on the same network.
- **Extensive flooding of LSAs** - Link-state routers flood their LSAs any time OSPF is initialized, or when there is a change in the topology. This flooding can become excessive.

To understand the problem with multiple adjacencies, we must study a formula:

For any number of routers (designated as _n_) on a multiaccess network, there are _n (n - 1) / 2_ adjacencies.

For example, the figure shows a simple topology of five routers, all of which are attached to the same multiaccess Ethernet network. Without some type of mechanism to reduce the number of adjacencies, collectively these routers would form 10 adjacencies:

**5 (5 - 1) / 2 = 10**

This may not seem like much, but as routers are added to the network, the number of adjacencies increases dramatically. For example, a multiaccess network with 20 routers would create 190 adjacencies

**Creating Adjacencies With Every Neighbor**![[Pasted image 20240929013400.png]]

## 1.3.6 LSA Flooding With a DR

A dramatic increase in the number of routers also dramatically increases the number of LSAs exchanged between the routers. This flooding of LSAs significantly impacts the operation of OSPF.

### Flooding LSAs
To understand the problem of extensive flooding of LSAs, play the animation in the figure. In the animation, R2 sends out an LSA. This event triggers every other router to also send out an LSA. Not shown in the animation are the required acknowledgments sent for every LSA received. If every router in a multiaccess network had to flood and acknowledge all received LSAs to all other routers on that same multiaccess network, the network traffic would become quite chaotic.
![[Pasted image 20240929013527.png]]![[Pasted image 20240929013535.png]]![[Pasted image 20240929013553.png]]![[Pasted image 20240929013609.png]]

### LSAs and DR

The solution to managing the number of adjacencies and the flooding of LSAs on a multiaccess network is the DR. On multiaccess networks, OSPF elects a DR to be the collection and distribution point for LSAs sent and received. A BDR is also elected in case the DR fails. All other routers become DROTHERs. A DROTHER is a router that is neither the DR nor the BDR.

**Note:** The DR is only used for the dissemination of LSAs. The router will still use the best next-hop router indicated in the routing table for the forwarding of all other packets.

Play the animation in the figure to see the role of the DR.![[Pasted image 20240929013656.png]]![[Pasted image 20240929013702.png]]![[Pasted image 20240929013711.png]]![[Pasted image 20240929013717.png]]