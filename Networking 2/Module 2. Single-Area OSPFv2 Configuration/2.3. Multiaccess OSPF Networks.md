## 2.3.3 OSPF Multiaccess Reference Topology

In the multiaccess topology shown in the figure, there are three routers interconnected over a common Ethernet multiaccess network, 192.168.1.0/24. Each router is configured with the indicated IPv4 address on the Gigabit Ethernet 0/0/0 interface.

Because the routers are connected over a common multiaccess network, OSPF has automatically elected a DR and BDR. In this example, R3 has been elected as the DR because its router ID is 3.3.3.3, which is the highest in this network. R2 is the BDR because it has the second highest router ID in the network.
![[Pasted image 20241001182453.png]]

## 2.3.4 Verify OSPF Router Roles

To verify the roles of the OSPFv2 router, use the **show ip ospf** **interface** command.

### R1 DROTHER

The output generated by R1 confirms that the following:

1. R1 is not the DR or BDR, but is a DROTHER with a default priority of 1. (Line 7)
2. The DR is R3 with router ID 3.3.3.3 at IPv4 address 192.168.1.3, while the BDR is R2 with router ID 2.2.2.2 at IPv4 address 192.168.1.2. (Lines 8 and 9)
3. R1 has two adjacencies: one with the BDR and one with the DR. (Lines 20-22)

```
R1# show ip ospf interface GigabitEthernet 0/0/0
GigabitEthernet0/0/0 is up, line protocol is up 
  Internet Address 192.168.1.1/24, Area 0, Attached via Interface Enable
  Process ID 10, Router ID 1.1.1.1, Network Type BROADCAST, Cost: 1
  Topology-MTID    Cost    Disabled    Shutdown      Topology Name
        0           1         no          no            Base
  Enabled by interface config, including secondary ip addresses
  Transmit Delay is 1 sec, State DROTHER, Priority 1
  Designated Router (ID) 3.3.3.3, Interface address 192.168.1.3
  Backup Designated router (ID) 2.2.2.2, Interface address 192.168.1.2
  Timer intervals configured, Hello 10, Dead 40, Wait 40, Retransmit 5
    oob-resync timeout 40
    Hello due in 00:00:07
  Supports Link-local Signaling (LLS)
  Cisco NSF helper support enabled
  IETF NSF helper support enabled
  Index 1/1/1, flood queue length 0
  Next 0x0(0)/0x0(0)/0x0(0)
  Last flood scan length is 0, maximum is 1
  Last flood scan time is 0 msec, maximum is 1 msec
  Neighbor Count is 2, Adjacent neighbor count is 2 
    Adjacent with neighbor 2.2.2.2  (Backup Designated Router)
    Adjacent with neighbor 3.3.3.3  (Designated Router)
  Suppress hello for 0 neighbor(s)
R1#
```
### R2 BDR

The output generated by R2 confirms that:

1. R2 is the BDR with a default priority of 1. (Line 7)
2. The DR is R3 with router ID 3.3.3.3 at IPv4 address 192.168.1.3, while the BDR is R2 with router ID 2.2.2.2 at IPv4 address 192.168.1.2. (Lines 8 and 9)
3. R2 has two adjacencies; one with a neighbor with router ID 1.1.1.1 (R1) and the other with the DR. (Lines 20-22)

```
R2# show ip ospf interface GigabitEthernet 0/0/0
GigabitEthernet0/0/0 is up, line protocol is up 
  Internet Address 192.168.1.2/24, Area 0, Attached via Interface Enable
  Process ID 10, Router ID 2.2.2.2, Network Type BROADCAST, Cost: 1
  Topology-MTID    Cost    Disabled    Shutdown      Topology Name
        0           1         no          no            Base
  Enabled by interface config, including secondary ip addresses
  Transmit Delay is 1 sec, State BDR, Priority 1
  Designated Router (ID) 3.3.3.3, Interface address 192.168.1.3
  Backup Designated router (ID) 2.2.2.2, Interface address 192.168.1.2
  Timer intervals configured, Hello 10, Dead 40, Wait 40, Retransmit 5
    oob-resync timeout 40
    Hello due in 00:00:01
  Supports Link-local Signaling (LLS)
  Cisco NSF helper support enabled
  IETF NSF helper support enabled
  Index 1/1, flood queue length 0
  Next 0x0(0)/0x0(0)
  Last flood scan length is 0, maximum is 1
  Last flood scan time is 0 msec, maximum is 0 msec
  Neighbor Count is 2, Adjacent neighbor count is 2 
    Adjacent with neighbor 1.1.1.1
    Adjacent with neighbor 3.3.3.3  (Designated Router)
  Suppress hello for 0 neighbor(s)
R2#
```

### R3 DR

The output generated by R3 confirms that:

1. R3 is the DR with a default priority of 1. (Line 7)
2. The DR is R3 with router ID 3.3.3.3 at IPv4 address 192.168.1.3, while the BDR is R2 with router ID 2.2.2.2 at IPv4 address 192.168.1.2. (Lines 8 and 9)
3. R3 has two adjacencies: one with a neighbor with router ID 1.1.1.1 (R1) and the other with the BDR. (Lines 20-22)

```
R3# show ip ospf interface GigabitEthernet 0/0/0
GigabitEthernet0/0/0 is up, line protocol is up 
  Internet Address 192.168.1.3/24, Area 0, Attached via Interface Enable
  Process ID 10, Router ID 3.3.3.3, Network Type BROADCAST, Cost: 1
  Topology-MTID    Cost    Disabled    Shutdown      Topology Name
        0           1         no          no            Base
  Enabled by interface config, including secondary ip addresses
  Transmit Delay is 1 sec, State DR, Priority 1
  Designated Router (ID) 3.3.3.3, Interface address 192.168.1.3
  Backup Designated router (ID) 2.2.2.2, Interface address 192.168.1.2
  Timer intervals configured, Hello 10, Dead 40, Wait 40, Retransmit 5
    oob-resync timeout 40
    Hello due in 00:00:06
  Supports Link-local Signaling (LLS)
  Cisco NSF helper support enabled
  IETF NSF helper support enabled
  Index 1/1/1, flood queue length 0
  Next 0x0(0)/0x0(0)/0x0(0)
  Last flood scan length is 2, maximum is 2
  Last flood scan time is 0 msec, maximum is 0 msec
  Neighbor Count is 2, Adjacent neighbor count is 2 
    Adjacent with neighbor 1.1.1.1
    Adjacent with neighbor 2.2.2.2  (Backup Designated Router)
  Suppress hello for 0 neighbor(s)
R3#
```

## 2.3.5 Verify DR/BDR Adjacencies

To verify the OSPFv2 adjacencies, use the **show ip ospf neighbor** command, as shown in the example for R1. The state of neighbors in multiaccess networks can be as follows:

- **FULL/DROTHER** - This is a DR or BDR router that is fully adjacent with a non-DR or BDR router. These two neighbors can exchange Hello packets, updates, queries, replies, and acknowledgments.
- **FULL/DR** - The router is fully adjacent with the indicated DR neighbor. These two neighbors can exchange Hello packets, updates, queries, replies, and acknowledgments.
- **FULL/BDR** - The router is fully adjacent with the indicated BDR neighbor. These two neighbors can exchange Hello packets, updates, queries, replies, and acknowledgments.
- **2-WAY/DROTHER** - The non-DR or BDR router has a neighbor relationship with another non-DR or BDR router. These two neighbors exchange Hello packets.

The normal state for an OSPF router is usually FULL. If a router is stuck in another state, it is an indication that there are problems in forming adjacencies. The only exception to this is the 2-WAY state, which is normal in a multiaccess broadcast network. For examples, DROTHERs will form a 2-WAY neighbor adjacency with any DROTHERs that join the network. When this happens, the neighbor state displays as 2-WAY/DROTHER.

### R1 Adjacencies

The output generated by R1 confirms that R1 has adjacencies with the following routers:
- R2 with router ID 2.2.2.2 is in a Full state and the role of R2 is BDR.
- R3 with router ID 3.3.3.3 is in a Full state and the role of R3 is DR.
```
R1# show ip ospf neighbor 
Neighbor ID     Pri   State           Dead Time   Address         Interface
2.2.2.2           1   FULL/BDR        00:00:31    192.168.1.2     GigabitEthernet0/0/0
3.3.3.3           1   FULL/DR         00:00:39    192.168.1.3     GigabitEthernet0/0/0
R1#
```
### R2 Adjacencies 

The output generated by R2 confirms that R2 has adjacencies with the following routers:
- R1 with router ID 1.1.1.1 is in a Full state and R1 is neither the DR nor BDR.
- R3 with router ID 3.3.3.3 is in a Full state and the role of R3 is DR.
```
R2# show ip ospf neighbor 
Neighbor ID     Pri   State           Dead Time   Address         Interface
1.1.1.1           1   FULL/DROTHER    00:00:31    192.168.1.1     GigabitEthernet0/0/0
3.3.3.3           1   FULL/DR         00:00:34    192.168.1.3     GigabitEthernet0/0/0
R2#
```
### R3 Adjacencies

The output generated by R3 confirms that R3 has adjacencies with the following routers:
- R1 with router ID 1.1.1.1 is in a Full state and R1 is neither the DR nor BDR.
- R2 with router ID 2.2.2.2 is in a Full state and the role of R2 is BDR.
```
R3# show ip ospf neighbor 
Neighbor ID     Pri   State           Dead Time   Address         Interface
1.1.1.1           1   FULL/DROTHER    00:00:37    192.168.1.1     GigabitEthernet0/0/0
2.2.2.2           1   FULL/BDR        00:00:33    192.168.1.2     GigabitEthernet0/0/0
R3#
```

## 2.3.6 Default DR/BDR Election Process

How do the DR and BDR get elected? The OSPF DR and BDR election decision is based on the following criteria, in sequential order:

1. The routers in the network elect the router with the highest interface priority as the DR. The router with the second highest interface priority is elected as the BDR. The priority can be configured to be any number between 0 - 255. If the interface priority value is set to 0, that interface cannot be elected as DR nor BDR. The default priority of multiaccess broadcast interfaces is 1. Therefore, unless otherwise configured, all routers have an equal priority value and must rely on another tie breaking method during the DR/BDR election.
2. If the interface priorities are equal, then the router with the highest router ID is elected the DR. The router with the second highest router ID is the BDR.

Recall that the router ID is determined in one of the following three ways:

1. The router ID can be manually configured.
2. If no router IDs are configured, the router ID is determined by the highest loopback IPv4 address.
3. If no loopback interfaces are configured, the router ID is determined by the highest active IPv4 address.
### OSPFv2 Multiaccess Reference Topology
![[Pasted image 20241001183056.png]]
In the figure, all Ethernet router interfaces have a default priority of 1. As a result, based on the selection criteria listed above, the OSPF router ID is used to elect the DR and BDR. R3 with the highest router ID becomes the DR; and R2, with the second highest router ID, becomes the BDR.

The DR and BDR election process takes place as soon as the first router with an OSPF-enabled interface is active on the multiaccess network. This can happen when the preconfigured OSPF routers are powered on, or when OSPF is activated on the interface. The election process only takes a few seconds. If all of the routers on the multiaccess network have not finished booting, it is possible that a router with a lower router ID becomes the DR.

OSPF DR and BDR elections are not pre-emptive. If a new router with a higher priority or higher router ID is added to the network after the DR and BDR election, the newly added router does not take over the DR or the BDR role. This is because those roles have already been assigned. The addition of a new router does not initiate a new election process.

## 2.3.7 DR Failure and Recovery

After the DR is elected, it remains the DR until one of the following events occurs:

- The DR fails.
- The OSPF process on the DR fails or is stopped.
- The multiaccess interface on the DR fails or is shutdown.

If the DR fails, the BDR is automatically promoted to DR. This is the case even if another DROTHER with a higher priority or router ID is added to the network after the initial DR/BDR election. However, after a BDR is promoted to DR, a new BDR election occurs and the DROTHER with the highest priority or router ID is elected as the new BDR.

### R3 Fails
After the DR is elected, it remains the DR until one of the following events occurs:

- The DR fails.
- The OSPF process on the DR fails or is stopped.
- The multiaccess interface on the DR fails or is shutdown.

If the DR fails, the BDR is automatically promoted to DR. This is the case even if another DROTHER with a higher priority or router ID is added to the network after the initial DR/BDR election. However, after a BDR is promoted to DR, a new BDR election occurs and the DROTHER with the highest priority or router ID is elected as the new BDR.
![[Pasted image 20241001183159.png]]
### R3 Re-Joins Network

In this scenario, R3 has re-joined the network after several minutes of being unavailable. Because the DR and BDR already exist, R3 does not take over either role. Instead, it becomes a DROTHER.
![[Pasted image 20241001183231.png]]
### R4 Joins Network

In this scenario, a new router (R4) with a higher router ID is added to the network. DR (R2) and BDR (R1) retain the DR and BDR roles. R4 automatically becomes a DROTHER.

![[Pasted image 20241001183308.png]]

## 2.3.8 The ip ospf priority Command

If the interface priorities are equal on all routers, the router with the highest router ID is elected the DR. It is possible to configure the router ID to manipulate the DR/BDR election. However, this process only works if there is a stringent plan for setting the router ID on all routers. Configuring the router ID can help control this. However, in large networks this can be cumbersome.

Instead of relying on the router ID, it is better to control the election by setting interface priorities. This also allows a router to be the DR in one network and a DROTHER in another. To set the priority of an interface, use the command **ip ospf priority** _value_, where value is 0 to 255. A value of 0 does not become a DR or a BDR. A value of 1 to 255 on the interface makes it more likely that the router becomes the DR or the BDR.

## 2.3.9 Configure OSPF Priority

In the topology, the **ip ospf priority** command will be used to change the DR and BDR as follows:

- R1 should be the DR and will be configured with a priority of 255.
- R2 should be the BDR and will be left with the default priority of 1.
- R3 should never be a DR or BDR and will be configured with a priority of 0.

Change the R1 G0/0/0 interface priority from 1 to 255.
```
R1(config)# interface GigabitEthernet 0/0/0 R1(config-if)# ip ospf priority 255 R1(config-if)# end R1#
```

Change the R3 G0/0/0 interface priority from 1 to 0.
```
R3(config)# interface GigabitEthernet 0/0/0R3(config-if)# ip ospf priority 0R3(config-if)# endR3#
```

The following example, shows how to clear the OSPF process on R1. The **clear ip ospf process** command also must be entered on R2 and R3 (not shown). Notice the OSPF state information that is generated.
```
R1# clear ip ospf processReset ALL OSPF processes? [no]: yR1#*Jun  5 03:47:41.563: %OSPF-5-ADJCHG: Process 10, Nbr 2.2.2.2 on GigabitEthernet0/0/0 from FULL to DOWN, Neighbor Down: Interface down or detached*Jun  5 03:47:41.563: %OSPF-5-ADJCHG: Process 10, Nbr 3.3.3.3 on GigabitEthernet0/0/0 from FULL to DOWN, Neighbor Down: Interface down or detached*Jun  5 03:47:41.569: %OSPF-5-ADJCHG: Process 10, Nbr 2.2.2.2 on GigabitEthernet0/0/0 from LOADING to FULL, Loading Done*Jun  5 03:47:41.569: %OSPF-5-ADJCHG: Process 10, Nbr 3.3.3.3 on GigabitEthernet0/0/0 from LOADING to FULL, Loading Done
```

The output from the **show in ospf interface g0/0/0** command on R1 confirms that R1 is now the DR with a priority of 255 and identifies the new neighbor adjacencies of R1.
```
R1# show ip ospf interface GigabitEthernet 0/0/0GigabitEthernet0/0/0 is up, line protocol is up   Internet Address 192.168.1.1/24, Area 0, Attached via Interface Enable  Process ID 10, Router ID 1.1.1.1, Network Type BROADCAST, Cost: 1  Topology-MTID    Cost    Disabled    Shutdown      Topology Name        0           1         no          no            Base  Enabled by interface config, including secondary ip addresses  Transmit Delay is 1 sec, State DR, Priority 255  Designated Router (ID) 1.1.1.1, Interface address 192.168.1.1  Backup Designated router (ID) 2.2.2.2, Interface address 192.168.1.2  Timer intervals configured, Hello 10, Dead 40, Wait 40, Retransmit 5    oob-resync timeout 40    Hello due in 00:00:00  Supports Link-local Signaling (LLS)  Cisco NSF helper support enabled  IETF NSF helper support enabled  Index 1/1/1, flood queue length 0  Next 0x0(0)/0x0(0)/0x0(0)  Last flood scan length is 1, maximum is 2  Last flood scan time is 0 msec, maximum is 1 msec  Neighbor Count is 2, Adjacent neighbor count is 2     Adjacent with neighbor 2.2.2.2  (Backup Designated Router)    Adjacent with neighbor 3.3.3.3  Suppress hello for 0 neighbor(s)R1#
```
